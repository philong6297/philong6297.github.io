<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=content-language content="en">
<meta name=color-scheme content="light dark">
<meta http-equiv=content-security-policy content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self'; img-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/; script-src 'self' 'unsafe-inline' https://www.google-analytics.com; prefetch-src 'self'; connect-src 'self' https://www.google-analytics.com;">
<meta name=author content="Long Phi Le">
<meta name=description content="Introduction    For me, everytime I encounter the stituation and document myself about, I still end up with the same conclusions:
 Inlining is often to be misused in development, ending up in counter-productive and risky situations.
 I will try to summarize all the things which I believe we need to remember about inlining, giving pros, cons and situations to use it and to not use it.">
<meta name=keywords content="blog,developer,personal">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="About inlining">
<meta name=twitter:description content="Introduction    For me, everytime I encounter the stituation and document myself about, I still end up with the same conclusions:
 Inlining is often to be misused in development, ending up in counter-productive and risky situations.
 I will try to summarize all the things which I believe we need to remember about inlining, giving pros, cons and situations to use it and to not use it.">
<meta property="og:title" content="About inlining">
<meta property="og:description" content="Introduction    For me, everytime I encounter the stituation and document myself about, I still end up with the same conclusions:
 Inlining is often to be misused in development, ending up in counter-productive and risky situations.
 I will try to summarize all the things which I believe we need to remember about inlining, giving pros, cons and situations to use it and to not use it.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://philong6297.github.io/posts/about_inlining/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-11-20T00:00:00+00:00">
<meta property="article:modified_time" content="2021-11-20T00:00:00+00:00">
<title>
About inlining · LongLP
</title>
<link rel=canonical href=https://philong6297.github.io/posts/about_inlining/>
<link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin>
<link rel=stylesheet href=/css/coder.min.d9fddbffe6f27e69985dc5fe0471cdb0e57fbf4775714bc3d847accb08f4a1f6.css integrity="sha256-2f3b/+byfmmYXcX+BHHNsOV/v0d1cUvD2Eesywj0ofY=" crossorigin=anonymous media=screen>
<link rel=stylesheet href=/css/coder-dark.min.aa883b9ce35a8ff4a2a5008619005175e842bb18a8a9f9cc2bbcf44dab2d91fa.css integrity="sha256-qog7nONaj/SipQCGGQBRdehCuxioqfnMK7z0Tastkfo=" crossorigin=anonymous media=screen>
<link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32>
<link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16>
<link rel=apple-touch-icon href=/images/apple-touch-icon.png>
<link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png>
<meta name=generator content="Hugo 0.89.4">
</head>
<body class="preload-transitions colorscheme-auto">
<div class=float-container>
<a id=dark-mode-toggle class=colorscheme-toggle>
<i class="fa fa-adjust fa-fw" aria-hidden=true></i>
</a>
</div>
<main class=wrapper>
<nav class=navigation>
<section class=container>
<a class=navigation-title href=/>
LongLP
</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle>
<i class="fa fa-bars fa-fw" aria-hidden=true></i>
</label>
<ul class=navigation-list>
<li class=navigation-item>
<a class=navigation-link href=/about/>About</a>
</li>
<li class=navigation-item>
<a class=navigation-link href=/posts/>Blog</a>
</li>
<li class=navigation-item>
<a class=navigation-link href=/projects/>Projects</a>
</li>
<li class=navigation-item>
<a class=navigation-link href=/contact/>Contact me</a>
</li>
</ul>
</section>
</nav>
<div class=content>
<section class="container post">
<article>
<header>
<div class=post-title>
<h1 class=title>
<a class=title-link href=https://philong6297.github.io/posts/about_inlining/>
About inlining
</a>
</h1>
</div>
<div class=post-meta>
<div class=date>
<span class=posted-on>
<i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2021-11-20T00:00:00Z>
November 20, 2021
</time>
</span>
<span class=reading-time>
<i class="fa fa-clock-o" aria-hidden=true></i>
5-minute read
</span>
</div>
<div class=tags>
<i class="fa fa-tag" aria-hidden=true></i>
<span class=tag>
<a href=/tags/cpp/>cpp</a>
</span></div>
</div>
</header>
<div>
<h2 id=introduction>
Introduction
<a class=heading-link href=#introduction>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2>
<p>For me, everytime I encounter the stituation and document myself about, I still end up with the same conclusions:</p>
<blockquote>
<p>Inlining is often to be misused in development, ending up in counter-productive and risky situations.</p>
</blockquote>
<p>I will try to summarize all the things which I believe we need to remember about inlining, giving pros, cons and situations to use it and to not use it.</p>
<h2 id=definition>
Definition
<a class=heading-link href=#definition>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2>
<p>From the C++ standard definition of <code>inline</code>:</p>
<blockquote>
<p>The original intent of the <code>inline</code> keyword was to serve as an indicator to the optimizer that <a href=https://en.wikipedia.org/wiki/Inline_expansion>inline substitution of a function</a> is preferred over function call, that is, instead of executing the function call CPU instruction to transfer control to the function body, a copy of the function body is executed without generating the call. This avoids overhead created by the function call (passing the arguments and retrieving the result) but it may result in a larger executable as the code for the function has to be repeated multiple times.</p>
</blockquote>
<blockquote>
<p>Since this meaning of the keyword <code>inline</code> is non-binding, compilers are free to use inline substitution for any function that&rsquo;s not marked <code>inline</code>, and are free to generate function calls to any function marked <code>inline</code>. Those optimization choices do not change the rules regarding multiple definitions and shared statics listed above.</p>
</blockquote>
<p>Source : <a href=https://en.cppreference.com/w/cpp/language/inline>inline specifier – cppreference.com</a></p>
<p>What we need to notice from that are two things :</p>
<ul>
<li><code>inline</code> is used to avoid function overhead, replacing the call by the implementation at compile time.</li>
<li>It is only a <em><strong>hint</strong></em>, not a <em><strong>command</strong></em>, given to the compiler. Some functions declared inline may not really be inlined, and vice-versa (I really wish the keyword will be <code>maybe_inline</code> in the future).</li>
</ul>
<p>With that in mind, let’s take a tour of the pros and the cons of this feature.</p>
<h2 id=pros>
Pros
<a class=heading-link href=#pros>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2>
<p>First of all, even if it’s a <em><strong>hint</strong></em>, the keyword <strong>still</strong> has a chance to influence the compiler. It may not, but it also may. For instance, we can think of the stupidest compiler that will just strictly respect the <code>inline</code> keyword, without trying to analyze the context and optimize himself. This is not against the standard (according to the C++11 standard §12.1.5) and the keyword <em><strong>is</strong></em> useful in this case.</p>
<p>To be summarized, the pros are:</p>
<ol>
<li>It speeds up your program by avoiding function calling overhead.</li>
<li>It save overhead of variables push/pop on the stack, when function calling happens.</li>
<li>It save overhead of return call from a function.</li>
<li>It increases locality of reference by utilizing instruction cache.</li>
<li>By marking it as inline, you can put a function definition in a header file (i.e. it can be included in multiple compilation unit, without the linker complaining).</li>
</ol>
<p>The first three benefits are overally the main benefits of this feature, and the original goal of the introduction of this keyword. Those who know a bit of assembly know that pushing a lot of parameters on the stack to call function can cost more instructions that the function holds.</p>
<p>Point number 4 seems to be a non-negligible side-benefit of this method, but since instruction cache is far from being my specialty, I will not develop on this.</p>
<p>The last one is pro only in certain specific cases, but still a pro nonetheless.</p>
<h2 id=cons>
Cons
<a class=heading-link href=#cons>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2>
<ol>
<li>It increases the executable size due to code expansion.</li>
<li>C++ inlining is resolved at compile time. Which means if you change the code of the inlined function, you would need to recompile all the code using it to make sure it will be updated</li>
<li>When used in a header, it makes your header file larger with information which users don’t care.</li>
<li>As mentioned above it increases the executable size, which may cause thrashing in memory. More number of page fault bringing down your program performance.</li>
<li>Sometimes inlining is not useful. For example, in embedded system where large executable size is not preferred at all due to memory constraints.</li>
</ol>
<p>Points 1 and 4 are the main reason that function inlining can decrease performance. It is important to remember that when using this feature.</p>
<p>Point 2 can be a major inconvenient, depending on your project.</p>
<p>Point 3 is, in my opinion, the main drawback of inlining. In order to have maintainable code you need to have to be clear and organized. Inlining is a huge code smells in that regard.</p>
<p>The last one is about specific projects, so I will not develop further. But keep in mind that if you have memory constraints, inlining may have consequences.</p>
<h2 id=conlusion--when-to-use-the-inline-keyword->
Conlusion : when to use the inline keyword ?
<a class=heading-link href=#conlusion--when-to-use-the-inline-keyword->
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2>
<p>Avoiding function overhead is only usefull if you are in a performance critical part of your code.</p>
<p>We probably already know the Pareto’s law:</p>
<blockquote>
<p>80% of the execution happens in 20% of the code.</p>
</blockquote>
<p>This means that the program spends most of it’s time in bottlenecks. Thus, if you inline code that is not within a bottleneck, this will have little to no effect on your program performance, while increasing its size.</p>
<p>I saw several codebases polluted by useless <code>inline</code>s in non-critical code. There is absolutly no need in decreasing the readability of the code and increasing the executable size for that end.</p>
<p>Here is my oponion:</p>
<blockquote>
<p><strong>do not use <code>inline</code> until you have proofs from performance benchmark and you are sure it is inside a bottleneck.</strong></p>
</blockquote>
<p>This is the only way to be both efficient and clean.</p>
<h2 id=about-all-in-one-line-code-style---another-type-of-inlining>
About &ldquo;All In One Line&rdquo; code style - another type of inlining
<a class=heading-link href=#about-all-in-one-line-code-style---another-type-of-inlining>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2>
<p>If you are someone who likes to write something like this one:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-cpp data-lang=cpp><span style=color:#ff79c6>inline</span> <span style=color:#ff79c6>auto</span> <span style=color:#50fa7b>set_value</span>(<span style=color:#ff79c6>const</span> <span style=color:#8be9fd>int32_t</span> i) <span style=color:#ff79c6>noexcept</span> { value_ <span style=color:#ff79c6>=</span> i; }
</code></pre></td></tr></table>
</div>
</div><p>By using the prototype and the implementation all on one line, you prevent several debuggers from doing their jobs properly.</p>
<p>For instance, in Visual Studio, if you put a breakpoint inside this <code>set_value</code> method, when it hits the debugger won’t be able to give you the value of <code>value_</code>.</p>
<p>Just stop doing that. It won’t cost you much to add a newline:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-cpp data-lang=cpp><span style=color:#ff79c6>inline</span> <span style=color:#ff79c6>auto</span> <span style=color:#50fa7b>set_value</span>(<span style=color:#ff79c6>const</span> <span style=color:#8be9fd>int32_t</span> i) <span style=color:#ff79c6>noexcept</span> {
  value_ <span style=color:#ff79c6>=</span> i; <span style=color:#6272a4>// put your breakpoint in here
</span><span style=color:#6272a4></span>}
</code></pre></td></tr></table>
</div>
</div>
</div>
<footer>
</footer>
</article>
</section>
</div>
<footer class=footer>
<section class=container>
©
2021
Long Phi Le
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.
</section>
</footer>
</main>
<script src=/js/coder.min.03b17769f4f91ae35667e1f2a1ca8c16f50562576cf90ff32b3179926914daa5.js integrity="sha256-A7F3afT5GuNWZ+HyocqMFvUFYlds+Q/zKzF5kmkU2qU="></script>
</body>
</html>